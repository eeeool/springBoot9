<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
                xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
                layout:decorate="~{layouts/basicLayout}">

<div layout:fragment="content">
  <h2 class="text-center">서버 파일 리스트</h2>
  <hr/>
  <p>서버의 파일 경로 : /webapp/work/uploadTest/~~~파일명(총 : <b>[[${fileCnt}]]</b>개)</p>
  <hr/>
  <form name="myform">
    <div class="row mb-2">
      <div class="col">
        <input type="checkbox" id="checkAll"/>전체선택/해제 &nbsp;&nbsp;
        <input type="checkbox" id="reverseAll" onclick="reverseCheck()"/>선택반전 &nbsp;&nbsp;
      </div>
      <div class="col text-end">
        <input type="button" value="선택항목삭제" onclick="selectDelCheck()" class="btn btn-danger btn-sm mr-3"/>
        <input type="button" value="돌아가기" th:onclick="|location.href='@{/study/upload/uploadForm}'|" class="btn btn-warning btn-sm"/>
      </div>
    </div>
    <table class="table table-hover text-center">
      <tr class="table-secondary">
        <th>선택</th><th>번호</th><th>파일명</th><th>그림파일</th>
      </tr>
      <th:block th:if="${#lists.isEmpty(files)}">
        <td colspan="4" class="text-center">파일이 존재하지 않습니다.</td>
      </th:block>
      <th:block th:if="${!#lists.isEmpty(files)}">
        <th:block th:each="file, st : ${files}">
          <tr>
            <td>
              <input type="checkbox" name="chk" class="chk" th:value="${file}"/>
            </td>
            <td><a href="#" th:onclick="imgCheck([[${file}]])" data-bs-toggle="modal" data-bs-target="#myModal">[[${st.count}]]</a></td>
            <td><a th:href="@{/work/uploadTest/}+${file}" th:download="${file}" title="다운로드" class="text-dark link-primary link-underline-opacity-0 link-underline-opacity-100-hover">[[${file}]]</a></td>
            <td th:with="ext=${#strings.substring(file,#strings.length(file)-3)}">
              <th:block th:if="${ext=='jpg' or ext=='gif' or ext=='png'}">
                <a th:href="@{/work/uploadTest/}+${file}" target="_blank">
                  <img th:src="@{/work/uploadTest/}+${file}" width="100px"/>
                </a>
              </th:block>
              <th:block th:unless="${ext=='jpg' or ext=='gif' or ext=='png'}">
                [[${file}]]
              </th:block>
            </td>
          </tr>
        </th:block>
      </th:block>
    </table>
    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf?.token}" />
  </form>

  <!-- The Modal -->
  <div class="modal fade" id="myModal">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <!-- Modal Header -->
        <div class="modal-header">
          <h4 class="modal-title">Modal Heading</h4>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <!-- Modal body -->
        <div class="modal-body">
          <img id="imgSrc" width="460px"/>
          <div id="fileName"></div><br/>
        </div>
        <!-- Modal footer -->
        <div class="modal-footer">
          <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!-- 위로가기 버튼 -->
  <h6 id="topBtn" class="text-end me-3"><img src="/images/arrowTop.gif" title="위로이동"/></h6>

</div>

</html>